{% extends "blog/base_blog.html" %}
{% load blog tagging_tags inlines cache pygment_tags markup_tags threadedcomments_tags oembed_tags i18n tagging_related %}

{% block title %}{{ object.title }} | {{ block.super }}{% endblock %}

{% block meta %}
<meta name="keywords" content="{{ object.get_meta_keywords }}">
<meta name="description" content="{{ object.get_meta_description }}">
<meta name="author" content="{{ object.author.get_full_name }}" />
{% endblock %}

{% block body_class %}{{ block.super }} post_detail{% endblock %}
{% block body_id %}post_{{ object.id }}{% endblock %}

{% comment 'previous and next posts' %}
{% block content_title %}
  <p class="other_posts">
    {% if object.get_previous_by_publish %}
    <a class="previous" href="{{ object.get_previous_post.get_absolute_url }}">&laquo; {{ object.get_previous_post }}</a>
    {% endif %}
    {% if object.get_next_by_publish %}
    | <a class="next" href="{{ object.get_next_post.get_absolute_url }}">{{ object.get_next_post }} &raquo;</a>
    {% endif %}
  </p>
{% endblock %}
{% endcomment %}

{% block content %}

  <div class="post clearfix">
    <div class="date">{{ object.publish|date:"M d" }}</div>
    <h2>{{ object.title }}</h2>
    <p class="teaser">{{ object.tease|safe }}</p>
      <div class="body">
  {% oembed %}
      {{ object.body_markup|render_inlines|pygmentize|safe }}
  {% endoembed %}
      </div>
  </div>

  {% cache 300 "blog.post_detail.tag_list" object.pk %}
  {% tags_for_object object as tag_list %}
  {% if tag_list %}
  <p class="inline_tag_list"><strong>Tags:</strong>
    {% for tag in tag_list %}
    <a href="/tags/{{ tag }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
    {% endfor %}
  </p>
  {% endif %}
  {% endcache %}

  {% cache 1800 "blog.post_detail.related_list" object.pk %}
  {% tagged_get_related object in blog.Post as post_list with num=3 %}
  {% if post_list %}
  <div class="related-posts">
  <p class="inline_tag_list"><strong>Related posts:</strong></p>
  <ol>
  {% for post in post_list %}
  <li><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></li>
  {% endfor %}
  </ol>
  </div>
  {% endif %}
  {% endcache %}

  {% get_comment_list for object as responses %}
  <ul class="responses clearfix grid_9">
  {% for response in responses %}
    <li class="{% cycle even,odd %} comment-{{ response.pk }} clearfix">
          <div class="meta grid_2 alpha">
              <div class="respondent">
                  {% if response.user_url %}
                  <a href="{{ response.user_url }}">{{ response.name }}</a>
                  {% else %}
                  {{ response.name }}
                  {% endif %}
              </div>
              <div class="date">{{ response.submit_date|date }}</div>
          </div>
          <div class="body grid_7 omega">
              {{ response.comment|force_escape|apply_markup:"markdown"|pygmentize|safe }}
          </div>
      </li>
  {% endfor %}
  </ul>

  {% render_comment_form for object %}

{% endblock %}
